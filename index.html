<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Influencer Reputation</title>

  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b; --line:#e2e8f0;
      --shadow: 0 10px 25px rgba(2,6,23,.08); --radius: 16px;
      --blue:#2563eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .container{max-width:1180px;margin:22px auto 60px;padding:0 16px}

    /* ---------- Top selector bar ---------- */
    .topBar{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .picker{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    input[type="search"], select{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      background:#fff;
      font-weight:900;
      color:var(--text);
      outline:none;
      min-width:260px;
      flex:1;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:12px 12px;
      font-weight:1000;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.primary{
      background:#FFC600 !important;
      color:#0f172a !important;
      border-color:#FFC600 !important;
    }
    .btn.primary:hover{
      background:#FFB800 !important;
      border-color:#FFB800 !important;
    }
    .btn.primary:active{
     transform: translateY(1px);
    }
  
    /* ---------- Empty state ---------- */
    .empty{
      margin-top:16px;
      background:var(--card);
      border:1px dashed var(--line);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
    }
    .emptyTitle{margin:0 0 6px;font-size:18px;font-weight:1000}
    .emptyText{margin:0;color:var(--muted);font-weight:800;line-height:1.4}

    /* ---------- Main view ---------- */
    .header{
      margin-top:16px;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
    }
    .left{
      display:flex;
      gap:14px;
      align-items:center;
      flex-wrap:wrap;
      min-width:260px;
      flex:1;
    }
    .avatar{
      width:60px;height:60px;border-radius:999px;border:1px solid var(--line);
      background:linear-gradient(135deg,#c7d2fe,#e0e7ff);
      overflow:hidden;display:grid;place-items:center;font-weight:1000;color:#1e293b;
      cursor:pointer;
    }
    .avatar img{width:100%;height:100%;object-fit:cover}
    .title{margin:0;font-size:20px;font-weight:1000;line-height:1.1}
    .subRow{margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    a{color:var(--blue);text-decoration:none;font-weight:1000}
    a:hover{text-decoration:underline}
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      font-weight:1000;
      font-size:11px;
      background:#f8fafc;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }

    /* Score meter */
    .scoreCard{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
      min-width:240px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .scoreTop{display:flex;justify-content:space-between;align-items:flex-end;gap:10px}
    .scoreLabel{color:var(--muted);font-weight:1000;font-size:12px}
    .scoreValue{font-weight:1000;font-size:22px;line-height:1}
    .meter{
      width:100%;
      height:14px;
      border-radius:999px;
      background:#f1f5f9;
      border:1px solid var(--line);
      overflow:hidden;
    }
    .meterFill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, #16a34a 0%, #f59e0b 55%, #ef4444 100%);
      transition: width .2s ease;
    }
    .meterTicks{display:flex;justify-content:space-between;color:var(--muted);font-weight:900;font-size:11px}

    /* Cards */
    .grid{margin-top:16px;display:grid;grid-template-columns:1fr;gap:16px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .cardHeader{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .cardTitle{margin:0;font-weight:1000;font-size:15px}
    .muted{color:var(--muted);font-weight:750;font-size:13px;line-height:1.45}

    /* Flags + deep dive */
    .flagsWrap{display:grid;grid-template-columns: 1.1fr .9fr;gap:14px}
    @media (max-width: 920px){ .flagsWrap{grid-template-columns:1fr} }
    .flagsList{display:flex;flex-wrap:wrap;gap:8px}
    .flagChip{
      border:1px solid var(--line);
      background:#f8fafc;
      border-radius:999px;
      padding:7px 10px;
      font-weight:1000;
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }
    .flagChip.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .flagChip .count{
      background:#fff;border:1px solid var(--line);
      padding:3px 7px;border-radius:999px;font-size:11px;color:var(--muted)
    }
    .flagChip.active .count{color:#0f172a}
    .deepDive{
      border:1px solid var(--line);
      border-radius:16px;
      background:#fff;
      padding:12px;
      min-height:120px;
    }
    .deepDiveTitle{font-weight:1000;margin:0 0 10px;font-size:13px}
    .wordsGrid{display:flex;flex-wrap:wrap;gap:8px}
    .wordPill{
      font-size:12px;font-weight:1000;
      padding:7px 10px;border-radius:999px;border:1px solid var(--line);
      background:#fff;
    }

    /* Flag hits bar (0..33) */
    .kpi{
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      background:#fff;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .kpiTop{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap}
    .kpiTop .big{font-size:26px;font-weight:1000;line-height:1}
    .kpiTop .small{font-size:12px;color:var(--muted);font-weight:900;text-align:right}
    .bar{width:100%;height:12px;border-radius:999px;background:#f1f5f9;border:1px solid var(--line);overflow:hidden}
    .bar>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#ef4444,#f59e0b);transition:width .2s ease}
    .barLegend{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;font-weight:900}

    /* Summary (match layout font + spacing per item) */
    .summaryList{display:flex;flex-direction:column;gap:12px}
    .summaryItem{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:12px;
    }
    .summaryItemTitle{
      font-weight:1000;
      font-size:13px;
      margin:0 0 6px;
    }
    .summaryItemText{
      margin:0;
      color:var(--text);
      font-weight:500;
      font-size:13px;
      line-height:1.5;
      white-space:pre-wrap;
    }

    /* Evidence */
    .filters{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    .filterGroup{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .boxes{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width: 980px){.boxes{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 620px){.boxes{grid-template-columns:1fr}}

    .box{border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden;display:flex;flex-direction:column;min-height:220px}
    .boxImg{height:130px;background:linear-gradient(135deg,#e2e8f0,#f1f5f9)}
    .boxImg img{width:100%;height:100%;object-fit:cover}
    .boxBody{padding:12px;display:flex;flex-direction:column;gap:10px;flex:1}
    .boxTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
    .date{color:var(--muted);font-weight:900;font-size:11px}
    .titleLink{font-weight:1000;color:var(--blue);text-decoration:none;line-height:1.25;font-size:13px}
    .titleLink:hover{text-decoration:underline}
    .snippet{color:var(--text);font-weight:750;font-size:13px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;min-height:60px}
    .tagRow{display:flex;flex-wrap:wrap;gap:8px;margin-top:auto}
    .miniTag{font-size:11px;font-weight:1000;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--text)}

    .pagination{margin-top:14px;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap}
    .pageBtn{border:1px solid var(--line);background:#fff;padding:8px 10px;border-radius:10px;font-weight:1000;cursor:pointer;min-width:38px;text-align:center}
    .pageBtn.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .pageInfo{color:var(--muted);font-weight:900;font-size:12px;margin-top:10px;text-align:center}
  </style>
</head>

<body>
  <div class="container">

    <!-- TOP SELECTOR (always visible) -->
    <section class="topBar">
      <div class="picker">
        <input id="search" type="search" placeholder="Search by name or Instagram (e.g., Bad Bunny / @badbunnypr)"/>
        <select id="select">
          <option value="">Select an influencer…</option>
        </select>
        <button class="btn primary" id="openBtn">Open</button>

        <!-- Seletor de idioma (adição mínima) -->
        <select id="langSelect" style="max-width:180px;flex:0 0 auto">
          <option value="en" selected>English (EN)</option>
          <option value="pt">Português (PT)</option>
          <option value="es">Español (ES)</option>
        </select>
      </div>

      <!--
        ADD NEW INFLUENCER (markup only)
        1) Add influencer object into INFLUENCERS array in the script
        2) Add outputs into OUTPUTS map (key = influencer_id)
      -->
    </section>

    <!-- EMPTY STATE (shown until selection) -->
    <section class="empty" id="emptyState">
      <h2 class="emptyTitle">Select an influencer</h2>
      <p class="emptyText">
        Use the search box or the dropdown above. Once selected, the reputation view will appear here.
      </p>
    </section>

    <!-- MAIN VIEW (hidden until selection) -->
    <div id="mainView" style="display:none">
      <!-- Header -->
      <section class="header">
        <div class="left">
          <!-- Clicking avatar/name/handle goes to Instagram profile -->
          <a id="igHeaderLink" href="#" target="_blank" rel="noreferrer"
             style="display:flex;gap:14px;align-items:center;color:inherit;text-decoration:none">
            <div class="avatar" id="avatar">
              <img id="avatarImg" alt="avatar" src="" style="display:none"/>
              <span id="avatarFallback">IN</span>
            </div>
            <div>
              <h1 class="title" id="infName">—</h1>
              <div class="subRow">
                <span class="pill" id="igHandlePill">@—</span>
              </div>
            </div>
          </a>
        </div>

        <div class="scoreCard">
          <div class="scoreTop">
            <div>
              <div class="scoreLabel">Score (0–100)</div>
              <div class="scoreValue" id="scoreValue">0</div>
            </div>
          </div>
          <div class="meter"><div class="meterFill" id="meterFill"></div></div>
          <div class="meterTicks"><span>0</span><span>50</span><span>100</span></div>
        </div>
      </section>

      <div class="grid">

        <!-- (1) FLAGS + DEEP DIVE -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle">Flags (tags) + Deep dive (keywords)</h3>
          </div>

          <div class="flagsWrap">
            <div>
              <div class="flagsList" id="flagsList"></div>
              <div class="muted" style="margin-top:10px">
                Click a flag to see the detected keywords.
              </div>
            </div>

            <div class="deepDive">
              <p class="deepDiveTitle" id="deepDiveTitle">Detected keywords</p>
              <div class="wordsGrid" id="wordsGrid"></div>
              <div class="muted" id="deepDiveHint" style="margin-top:10px;display:none">
                No keywords for this flag.
              </div>
            </div>
          </div>
        </section>

        <!-- (2) FLAG HITS (0..33) -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle">Flag hits (0–33)</h3>
          </div>

          <div class="kpi">
            <div class="kpiTop">
              <div>
                <div style="font-weight:1000;font-size:13px">Total flags hit</div>
                <div class="big" id="flagHitsTotal">0</div>
              </div>
              <div class="small">
                Max: <span id="flagHitsMax">33</span><br/>
                % bar: <span id="flagHitsPct">0%</span>
              </div>
            </div>

            <div class="bar"><span id="flagHitsBar"></span></div>
            <div class="barLegend">
              <span>0</span><span>33</span>
            </div>

            <div class="muted">
              Total flags hit = number of <b>unique tags</b> detected for this influencer.
            </div>
          </div>
        </section>

        <!-- (3) SUMMARY -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle">Influencer Executive Assessment</h3>
          </div>
          <div class="summaryList" id="summaryList"></div>
        </section>

        <!-- (4) EVIDENCE -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle">Evidence (Web / News)</h3>
          </div>

          <div class="filters">
            <div class="filterGroup">
              <select id="flagFilter">
                <option value="all">Filter by Flag (tag)</option>
              </select>
              <select id="sortFilter">
                <option value="recent">Sort: Most recent</option>
                <option value="quantity">Sort: Quantity (keywords per tag)</option>
              </select>
            </div>
          </div>

          <div class="boxes" id="boxes"></div>

          <div class="pagination" id="pagination"></div>
          <div class="pageInfo" id="pageInfo"></div>

          <div class="muted" style="margin-top:12px">
            News cards attempt to load a website preview image via a public service (best effort).
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // ============================================================================
    // I18N MIN (adição mínima, não altera sua lógica)
    // ============================================================================
    let LANG = 'en';
    const I18N = {
      en: {
        search: "Search by name or Instagram (e.g., Bad Bunny / @badbunnypr)",
        open: "Open",
        emptyTitle: "Select an influencer",
        emptyText: "Use the search box or the dropdown above. Once selected, the reputation view will appear here.",
        scoreLabel: "Score (0–100)",
        flagsTitle: "Flags (tags) + Deep dive (keywords)",
        flagsHint: "Click a flag to see the detected keywords.",
        deepDiveTitle: "Detected keywords",
        deepDiveEmpty: "No keywords for this flag.",
        flagHitsTitle: "Flag hits (0–33)",
        flagHitsTotal: "Total flags hit",
        evidenceTitle: "Evidence (Web / News)",
        filterByFlag: "Filter by Flag (tag)",
        sortRecent: "Sort: Most recent",
        sortQuantity: "Sort: Quantity (keywords per tag)"
      },
      pt: {
        search: "Busque por nome ou Instagram (ex.: Bad Bunny / @badbunnypr)",
        open: "Abrir",
        emptyTitle: "Selecione um influencer",
        emptyText: "Use a busca ou o seletor acima. Ao selecionar, a visão de reputação aparece aqui.",
        scoreLabel: "Score (0–100)",
        flagsTitle: "Flags (tags) + Detalhamento (palavras‑chave)",
        flagsHint: "Clique em uma flag para ver as palavras‑chave detectadas.",
        deepDiveTitle: "Palavras‑chave detectadas",
        deepDiveEmpty: "Sem palavras‑chave para esta flag.",
        flagHitsTitle: "Flags acionadas (0–33)",
        flagHitsTotal: "Total de flags",
        evidenceTitle: "Evidências (Web / News)",
        filterByFlag: "Filtrar por Flag (tag)",
        sortRecent: "Ordenar: Mais recente",
        sortQuantity: "Ordenar: Quantidade (palavras‑chave por tag)"
      },
      es: {
        search: "Busca por nombre o Instagram (ej.: Bad Bunny / @badbunnypr)",
        open: "Abrir",
        emptyTitle: "Selecciona un influencer",
        emptyText: "Usa la búsqueda o el selector arriba. Al seleccionar, verás la vista de reputación aquí.",
        scoreLabel: "Puntaje (0–100)",
        flagsTitle: "Flags (tags) + Análisis (palabras clave)",
        flagsHint: "Haz clic en una flag para ver las palabras clave detectadas.",
        deepDiveTitle: "Palabras clave detectadas",
        deepDiveEmpty: "No hay palabras clave para esta flag.",
        flagHitsTitle: "Flags activadas (0–33)",
        flagHitsTotal: "Total de flags",
        evidenceTitle: "Evidencias (Web / Noticias)",
        filterByFlag: "Filtrar por Flag (tag)",
        sortRecent: "Ordenar: Más reciente",
        sortQuantity: "Ordenar: Cantidad (palabras clave por tag)"
      }
    };
    function applyI18N(){
      const L = I18N[LANG] || I18N.en;
      // Top
      document.getElementById('search').placeholder = L.search;
      document.getElementById('openBtn').textContent = L.open;
      // Empty
      const et = document.querySelector('.emptyTitle'); if(et) et.textContent = L.emptyTitle;
      const ex = document.querySelector('.emptyText');  if(ex) ex.textContent = L.emptyText;
      // Labels / titles
      const sl = document.querySelector('.scoreLabel'); if(sl) sl.textContent = L.scoreLabel;
      const titles = document.querySelectorAll('.cardTitle');
      if(titles[0]) titles[0].textContent = L.flagsTitle;
      const hint = document.querySelector('.flagsWrap .muted'); if(hint) hint.textContent = L.flagsHint;
      const dd = document.getElementById('deepDiveTitle'); if(dd) dd.textContent = L.deepDiveTitle;
      const ddh = document.getElementById('deepDiveHint'); if(ddh) ddh.textContent = L.deepDiveEmpty;
      if(titles[1]) titles[1].textContent = L.flagHitsTitle;
      if(titles[2]) titles[2].textContent = "Influencer Executive Assessment";
      if(titles[3]) titles[3].textContent = L.evidenceTitle;
      const ff = document.getElementById('flagFilter'); if(ff) ff.options[0].text = L.filterByFlag;
      const sf = document.getElementById('sortFilter'); if(sf){ sf.options[0].text = L.sortRecent; sf.options[1].text = L.sortQuantity; }
    }
    document.getElementById('langSelect').addEventListener('change', (e)=>{
      LANG = e.target.value || 'en';
      applyI18N();
    });

    // ============================================================================
    // INFLUENCERS LIST
    // ============================================================================
    const INFLUENCERS = [
      { influencer_id: "bad_bunny", name: "Bad Bunny", instagram_handle: "badbunnypr" },
      { influencer_id: "ewan_mcgregor", name: "Ewan McGregor", instagram_handle: "officialewanmcgregor_" },
      { influencer_id: "taylor_fritz",  name: "Taylor Fritz",  instagram_handle: "taylor_fritz" },
      { influencer_id: "vincent_cassel", name: "Vincent Cassel", instagram_handle: "vincentcassel" }
      // ADD NEXT INFLUENCER HERE (markup only)
      // { influencer_id: "cristiano", name: "Cristiano Ronaldo", instagram_handle: "cristiano" }
    ];

    // ============================================================================
    // OUTPUTS (manual paste) — CORRIGIDO
    // ============================================================================
    const OUTPUTS = {
      bad_bunny: {
        score_0_100: 85,

        flag_counting_rows: [
          {
            influencer: "Bad Bunny",
            tag: "sensitive political topics",
            // Principais termos recorrentes nos títulos/descrições do Excel
            words: "super|bowl|halftime|probe|congress|fcc|backlash|trump|maga|immigration|spanish|lyrics"
          }
        ],

        evidence_links_rows: [
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.axios.com/2026/02/10/bad-bunny-super-bowl-halftime-show-fcc-investigation" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.nytimes.com/2026/02/09/us/trump-bad-bunny-super-bowl-halftime-show.html" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.theguardian.com/us-news/2026/feb/08/bad-bunny-super-bowl-trump-maga" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.bbc.com/news/articles/cd0y18g8g7ro" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://people.com/gop-congressmen-want-investigation-bad-bunny-super-bowl-halftime-show-11904547" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://time.com/7376165/ogles-bad-bunny-super-bowl-halftime-sexual-lyrics-congress-investigation/" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.nbcnews.com/pop-culture/pop-culture-news/jill-zarin-fired-real-housewives-revival-show-controversial-bad-bunny-rcna258416" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://abcnews.go.com/US/trump-calls-bad-bunnys-super-bowl-halftime-show/story?id=129980124" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.cbc.ca/news/world/trump-bad-bunny-super-bowl-halftime-show-latino-voters-9.7081577" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.politico.com/news/2026/02/08/bad-bunny-super-bowl-immigration-00770475" }
        ],

        summary_text: `1. Profile Context
Bad Bunny é artista global de alto alcance. O review foi disparado por ampla cobertura sobre o show do Super Bowl e seu histórico de ativismo/temas sensíveis.
2. Positive Reputation Signals
Relevância cultural, alinhamento a diversidade e inclusão, forte tração com públicos jovens e multiculturais.
3. Legal, Regulatory & Reputational Exposure
Risco derivado de simbolismos políticos explícitos, críticas públicas e pedidos de investigação (incluindo FCC/Congresso) — potencial de polarização e escrutínio regulatório.
4. Net Brand Association Assessment
Exposição moderada–elevada, com benefícios de alcance e autenticidade para marcas confortáveis com causas sociais.
5. Recommendation
Apto com salvaguardas/monitoramento (checagem de conteúdo, governança de campanha, acompanhamento de backlash).`
      },

      // ==============================
      // Ewan McGregor
      // ==============================
      ewan_mcgregor: {
        score_0_100: 62,

        flag_counting_rows: [
          {
            influencer: "Ewan McGregor",
            tag: "Sensitive Political Topics",
            words: "snub|interview|piers|morgan|womens|march|row|boris|johnson|brexit|tweets|tirade"
          }
        ],

        evidence_links_rows: [
          {
            influencer: "Ewan McGregor",
            tag: "Sensitive Political Topics",
            url: "https://www.theguardian.com/film/2017/jan/24/ewan-mcgregor-snubs-good-morning-britain-interview-piers-morgan-womens-march-row"
          },
          {
            influencer: "Ewan McGregor",
            tag: "Sensitive Political Topics",
            url: "https://www.usatoday.com/story/news/nation-now/2016/06/30/ewan-mcgregor-foul-mouthed-tirade-boris-johnson-brexit/86554272/"
          }
        ],

        summary_text: `1. Profile Context
Ewan McGregor is a high-profile actor (global visibility). Assessment triggered by press items touching political commentary/sensitivity.
2. Positive Partnership Signals
Consistent professional standing and philanthropic participation; media presence is generally positive.
3. Legal, Regulatory & Reputational Exposure
Exposure stems from political commentary/alignments reported in press and past personal-life coverage. Monitor narratives across UK/US outlets.
4. Net Partnership Exposure Assessment
Overall manageable risk; maintain watch on sensitive topics and evolving news cycles.
5. Legal Positioning Recommendation
Suitable with safeguards / monitoring.`
      },

      // ==============================
      // Taylor Fritz
      // ==============================
      taylor_fritz: {
        score_0_100: 12,

        flag_counting_rows: [
          {
            influencer: "Taylor Fritz",
            tag: "Negative Sentiment",
            words: "trolls|abuse|comments|backlash|social|media|australian|open|criticize|defend|clap|respond"
          },
          {
            influencer: "Taylor Fritz",
            tag: "Collaboration Experience",
            words: "collaboration|brand|lifestyle|partnership|campaign|fashion|gen|crew|tennis|dc|open"
          },
          {
            influencer: "Taylor Fritz",
            tag: "Protest",
            words: "climate|protest|match|delay|washington|guardian|crowd|hold|off"
          },
          {
            influencer: "Taylor Fritz",
            tag: "Abuse",
            words: "harassment|online|abuse|trolls|backlash|comments|posts"
          }
        ],

        evidence_links_rows: [
          { influencer: "Taylor Fritz", tag: "Negative Sentiment", url: "https://www.dailymail.co.uk/sport/tennis/article-14494687/Tennis-WAG-Morgan-Riddle-boyfriend-Taylor-Fritz-trolls.html" },
          { influencer: "Taylor Fritz", tag: "Negative Sentiment", url: "https://www.express.co.uk/sport/tennis/2160031/taylor-fritz-girlfriend-morgan-riddle-australian-open" },
          { influencer: "Taylor Fritz", tag: "Collaboration Experience", url: "https://www.si.com/onsi/serve/interviews/taylor-fritz-beach-inspired-tennis-collaboration-dc-open" },
          { influencer: "Taylor Fritz", tag: "Collaboration Experience", url: "https://people.com/morgan-riddle-tennis-star-boyfriend-taylor-fritz-make-tennis-cool-again-7570078" },
          { influencer: "Taylor Fritz", tag: "Protest", url: "https://www.theguardian.com/sport/2023/aug/05/taylor-fritz-andy-murray-citi-open-climate-protest-tennis" },
          { influencer: "Taylor Fritz", tag: "Abuse", url: "https://www.express.co.uk/sport/tennis/2160031/taylor-fritz-girlfriend-morgan-riddle-australian-open" }
        ],

        summary_text: `1. Profile Context
Top US tennis player; high social reach via partner-driven content. Review triggered by waves of online discourse.
2. Positive Reputation Signals
Active collabs and lifestyle crossovers expand audience; mainstream sports coverage mostly positive.
3. Risk & Sensitivity Factors
Indirect exposure via social backlash toward partner/content; occasional association with protest-related match disruptions.
4. Net Brand Association Assessment
Low-to-moderate exposure; good fit for lifestyle/Gen Z positioning with standard guardrails.
5. Recommendation
Suitable with safeguards / monitoring (comment moderation; content review pre-brief).`
      },

      // ==============================
      // Vincent Cassel
      // ==============================
      vincent_cassel: {
        score_0_100: 30,

        flag_counting_rows: [
          {
            influencer: "Vincent Cassel",
            tag: "brand endorsement",
            words: "fashion|moncler|show|brand|campaign|style|cinema|influences|modeling|event|exclusive|dialogue"
          }
        ],

        evidence_links_rows: [
          {
            influencer: "Vincent Cassel",
            tag: "brand endorsement",
            url: "https://infobae.com/entretenimiento/2025/03/20/vincent-cassel-sobre-su-influencias-en-el-cine-y-la-moda-es-cuestion-de-dejarse-llevar"
          }
        ],

        summary_text: `1. Profile Context
Ator consagrado com aparições recentes em eventos de moda/brand (endorsement).
2. Positive Reputation Signals
Bom fit de imagem premium; nenhuma controvérsia relevante listada.
3. Risk & Sensitivity Factors
Baixa exposição legal/reputacional; atenção apenas a contratos e uso de imagem.
4. Net Brand Association Assessment
Associação positiva com lifestyle/fashion; risco baixo.
5. Recommendation
Apto (baixo risco) — boas oportunidades para colabs de moda/luxo.`
      }
    };

    // ============================================================================
    // DOM + STATE
    // ============================================================================
    const $ = (id) => document.getElementById(id);

    let selectedInfluencerId = "";
    let activeTag = null;
    let currentPage = 1;
    const pageSize = 6;

    // ============================================================================
    // Helpers - RECEITA DE BOLO DE MILHO VERDE
    // ============================================================================
    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    function escapeAttr(str){ return escapeHtml(str).replaceAll(" ","%20"); }

    function instagramUrl(handle){
      return `https://www.instagram.com/${encodeURIComponent(handle)}/`;
    }
    function instagramAvatarUrl(handle){
      return `https://unavatar.io/instagram/${encodeURIComponent(handle)}`;
    }

    function renderScore(score){
      const s = Math.max(0, Math.min(100, Number(score) || 0));
      $("scoreValue").textContent = String(s);
      $("meterFill").style.width = s + "%";
    }

    function buildTagKeywordsMap(rows){
      const map = new Map();
      (rows || []).forEach(r => {
        const tag = (r.tag || "").trim();
        const parts = String(r.words || "")
          .split("|")
          .map(w => w.trim())
          .filter(Boolean);

        if(!map.has(tag)) map.set(tag, new Set());
        const set = map.get(tag);
        parts.forEach(p => set.add(p));
      });
      return map;
    }

    function buildTagCounts(tagKeywordsMap){
      const counts = [];
      for(const [tag, set] of tagKeywordsMap.entries()){
        counts.push({ tag, count: set.size });
      }
      counts.sort((a,b) => b.count - a.count);
      return counts;
    }

    // Flag hits (0..33): number of unique tags found
    function computeFlagHits(tagCounts){
      return Math.min(33, (tagCounts || []).length);
    }

    function normalizeEvidence(rows){
      const seen = new Set();
      const out = [];
      (rows || []).forEach(r => {
        const tag = (r.tag || "").trim();
        const url = (r.url || "").trim();
        if(!tag || !url) return;

        const key = tag + "||" + url;
        if(seen.has(key)) return;
        seen.add(key);

        // Best-effort website preview image without API keys.
        // You can swap to another service later if needed.
        const previewImg = `https://image.thum.io/get/width/900/${encodeURIComponent(url)}`;

        out.push({
          evidence_id: "ev_" + String(out.length + 1).padStart(3,"0"),
          tag,
          url,
          title: url,            // INSERT NEXT: title if you start returning it
          snippet: "",           // INSERT NEXT: snippet if you start returning it
          publication_date: "",  // INSERT NEXT: date if you start returning it
          image_url: previewImg
        });
      });
      return out;
    }

    function renderDeepDive(tag, tagKeywordsMap){
      const set = tagKeywordsMap.get(tag) || new Set();
      $("deepDiveTitle").textContent = `Detected keywords — ${tag}`;
      $("wordsGrid").innerHTML = Array.from(set)
        .sort((a,b)=>a.localeCompare(b))
        .map(w => `<span class="wordPill">${escapeHtml(w)}</span>`)
        .join("");
      $("deepDiveHint").style.display = set.size ? "none" : "block";
    }

    // Summary parsing into items
    function parseSummaryToItems(text){
      const raw = String(text || "").trim();
      if(!raw) return [];

      const lines = raw.split("\n");
      const items = [];
      let current = null;

      function pushCurrent(){
        if(current && (current.title || current.body)){
          current.body = (current.body || "").trim();
          items.push(current);
        }
      }

      for(const line of lines){
        const m = line.match(/^(\d+)\.\s*(.+)$/);
        if(m){
          pushCurrent();
          current = { title: m[2].trim(), body: "" };
        }else{
          if(!current){
            current = { title: "Summary", body: "" };
          }
          current.body += (current.body ? "\n" : "") + line;
        }
      }
      pushCurrent();
      return items;
    }

    // Evidence: filter + sort + pagination
    function getFilteredEvidence(evidence){
      const tag = $("flagFilter").value;
      const sort = $("sortFilter").value;

      let list = [...evidence];
      if(tag !== "all") list = list.filter(ev => ev.tag === tag);

      if(sort === "quantity"){
        list.sort((a,b) => (b._tag_keyword_count||0) - (a._tag_keyword_count||0));
      }else{
        list.sort((a,b) => (b.publication_date||"").localeCompare(a.publication_date||""));
      }
      return list;
    }

    function buildPagination(totalPages){
      const btns = [];
      btns.push(`<div class="pageBtn" onclick="goPage(${Math.max(1, currentPage-1)})">«</div>`);

      const maxButtons = 7;
      let from = Math.max(1, currentPage - 2);
      let to = Math.min(totalPages, from + (maxButtons - 1));
      from = Math.max(1, to - (maxButtons - 1));

      for(let p=from;p<=to;p++){
        btns.push(`<div class="pageBtn ${p===currentPage?'active':''}" onclick="goPage(${p})">${p}</div>`);
      }
      btns.push(`<div class="pageBtn" onclick="goPage(${Math.min(totalPages, currentPage+1)})">»</div>`);
      return btns.join("");
    }
    window.goPage = function(p){
      currentPage = p;
      renderMain();
      window.scrollTo({ top: document.querySelector(".filters").getBoundingClientRect().top + window.scrollY - 140, behavior:"smooth" });
    };

    function renderEvidence(evidence){
      const list = getFilteredEvidence(evidence);
      const total = list.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      currentPage = Math.min(currentPage, totalPages);

      const start = (currentPage - 1) * pageSize;
      const slice = list.slice(start, start + pageSize);

      $("boxes").innerHTML = slice.map(ev => {
        const imgHtml = ev.image_url
          ? `<div class="boxImg">
               <img alt="preview" src="${escapeAttr(ev.image_url)}"
                    onerror="this.remove(); this.parentElement.style.display='none'"/>
             </div>`
          : ``;

        return `
          <div class="box">
            ${imgHtml}
            <div class="boxBody">
              <div class="boxTop">
                <span class="pill">WEB/NEWS</span>
                <span class="date">${escapeHtml(ev.publication_date || "")}</span>
              </div>
              <a class="titleLink" href="${escapeAttr(ev.url)}" target="_blank" rel="noreferrer">
                ${escapeHtml(ev.title || ev.url)}
              </a>
              <div class="snippet">${escapeHtml(ev.snippet || "")}</div>
              <div class="tagRow">
                <span class="miniTag">tag: ${escapeHtml(ev.tag)}</span>
                <span class="miniTag">keywords: ${escapeHtml(ev._tag_keyword_count || 0)}</span>
              </div>
            </div>
          </div>
        `;
      }).join("") || `<div class="muted">No evidence for this filter.</div>`;

      $("pagination").innerHTML = buildPagination(totalPages);
      const showingFrom = total === 0 ? 0 : start + 1;
      const showingTo = Math.min(total, start + slice.length);
      $("pageInfo").textContent = `${showingFrom} - ${showingTo} of ${total} (page ${currentPage}/${totalPages})`;
    }

    // ============================================================================
    // Main render after selection
    // ============================================================================
    function renderMain(){
      if(!selectedInfluencerId){
        $("mainView").style.display = "none";
        $("emptyState").style.display = "block";
        applyI18N(); // mantém textos coerentes com idioma
        return;
      }

      const inf = INFLUENCERS.find(x => x.influencer_id === selectedInfluencerId);
      const out = OUTPUTS[selectedInfluencerId];

      $("emptyState").style.display = "none";
      $("mainView").style.display = "block";

      // Instagram header link (avatar + name + handle)
      const ig = instagramUrl(inf.instagram_handle);
      $("igHeaderLink").href = ig;
      $("igHandlePill").textContent = `@${inf.instagram_handle}`;

      // Header
      $("infName").textContent = inf?.name || "—";
      $("avatarFallback").textContent = (inf?.name || "IN")
        .split(" ").slice(0,2).map(x=>x[0]).join("").toUpperCase();

      const img = $("avatarImg");
      img.src = instagramAvatarUrl(inf.instagram_handle);
      img.onload = () => { img.style.display="block"; $("avatarFallback").style.display="none"; };
      img.onerror = () => { img.style.display="none"; $("avatarFallback").style.display="block"; };

      renderScore(out?.score_0_100 ?? 0);

      // Compute tags/keywords
      const tagKeywordsMap = buildTagKeywordsMap(out?.flag_counting_rows || []);
      const tagCounts = buildTagCounts(tagKeywordsMap);

      if(!activeTag){
        activeTag = tagCounts[0]?.tag || null;
      }

      // Flags list
      $("flagsList").innerHTML = tagCounts.map(x => `
        <span class="flagChip ${x.tag===activeTag?'active':''}" data-tag="${escapeAttr(x.tag)}">
          ${escapeHtml(x.tag)}
          <span class="count">${escapeHtml(x.count)}</span>
        </span>
      `).join("") || `<span class="muted">No flags.</span>`;

      document.querySelectorAll(".flagChip").forEach(el => {
        el.addEventListener("click", () => {
          activeTag = el.getAttribute("data-tag");
          renderMain();
        });
      });

      // Deep dive
      if(activeTag) renderDeepDive(activeTag, tagKeywordsMap);

      // Flag hits (0..33)
      const hits = computeFlagHits(tagCounts);
      const pct = Math.round((hits / 33) * 100);
      $("flagHitsTotal").textContent = String(hits);
      $("flagHitsMax").textContent = "33";
      $("flagHitsPct").textContent = pct + "%";
      $("flagHitsBar").style.width = pct + "%";

      // Summary -> items
      const items = parseSummaryToItems(out?.summary_text || "");
      $("summaryList").innerHTML = items.map(it => `
        <div class="summaryItem">
          <p class="summaryItemTitle">${escapeHtml(it.title)}</p>
          <p class="summaryItemText">${escapeHtml(it.body)}</p>
        </div>
      `).join("") || `<div class="muted">—</div>`;

      // Evidence
      const evidence = normalizeEvidence(out?.evidence_links_rows || []);
      evidence.forEach(ev => {
        const set = tagKeywordsMap.get(ev.tag) || new Set();
        ev._tag_keyword_count = set.size;
      });

      // Build tag filter options
      const tags = tagCounts.map(x => x.tag);
      const currentFilter = $("flagFilter").value || "all";
      $("flagFilter").innerHTML =
        `<option value="all">Filter by Flag (tag)</option>` +
        tags.map(tg => `<option value="${escapeAttr(tg)}">${escapeHtml(tg)}</option>`).join("");

      if(tags.includes(currentFilter)) $("flagFilter").value = currentFilter;
      else $("flagFilter").value = "all";

      renderEvidence(evidence);

      // Aplica i18n após render (mantém seu fluxo)
      applyI18N();
    }

    // ============================================================================
    // Selector behavior (search filters select list)
    // ============================================================================
    function populateSelect(options){
      $("select").innerHTML = `<option value="">Select an influencer…</option>` +
        options.map(i => `<option value="${escapeAttr(i.influencer_id)}">${escapeHtml(i.name)} (@${escapeHtml(i.instagram_handle)})</option>`).join("");
    }

    function applySearch(){
      const q = $("search").value.trim().toLowerCase();
      const filtered = INFLUENCERS.filter(i =>
        !q ||
        i.name.toLowerCase().includes(q) ||
        i.instagram_handle.toLowerCase().includes(q) ||
        ("@" + i.instagram_handle).toLowerCase().includes(q)
      );
      populateSelect(filtered);
    }

    $("search").addEventListener("input", () => {
      const current = $("select").value;
      applySearch();
      $("select").value = current;
    });

    function openSelected(){
      selectedInfluencerId = $("select").value || "";
      activeTag = null;
      currentPage = 1;
      renderMain();
    }

    $("openBtn").addEventListener("click", () => {
      if(!$("select").value){
        selectedInfluencerId = "";
        renderMain();
        return;
      }
      openSelected();
    });

    $("flagFilter").addEventListener("change", () => { currentPage = 1; renderMain(); });
    $("sortFilter").addEventListener("change", () => { currentPage = 1; renderMain(); });

    // Init
    applyI18N();
    populateSelect(INFLUENCERS);
    renderMain();
  </script>
</body>
</html>
