<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Influencer Reputation</title>

  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b; --line:#e2e8f0;
      --shadow: 0 10px 25px rgba(2,6,23,.08); --radius: 16px;
      --blue:#2563eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .container{max-width:1180px;margin:22px auto 60px;padding:0 16px}

    /* ---------- Top selector bar ---------- */
    .topBar{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .picker{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    input[type="search"], select{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      background:#fff;
      font-weight:900;
      color:var(--text);
      outline:none;
      min-width:220px;
      flex:1;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:12px 12px;
      font-weight:1000;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.primary{
      background:#FFC600 !important;
      color:#0f172a !important;
      border-color:#FFC600 !important;
    }
    .btn.primary:hover{
      background:#FFB800 !important;
      border-color:#FFB800 !important;
    }
    .btn.primary:active{
     transform: translateY(1px);
    }
  
    /* ---------- Empty state ---------- */
    .empty{
      margin-top:16px;
      background:var(--card);
      border:1px dashed var(--line);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
    }
    .emptyTitle{margin:0 0 6px;font-size:18px;font-weight:1000}
    .emptyText{margin:0;color:var(--muted);font-weight:800;line-height:1.4}

    /* ---------- Main view ---------- */
    .header{
      margin-top:16px;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      flex-wrap:wrap;
    }
    .left{
      display:flex;
      gap:14px;
      align-items:center;
      flex-wrap:wrap;
      min-width:260px;
      flex:1;
    }
    .avatar{
      width:60px;height:60px;border-radius:999px;border:1px solid var(--line);
      background:linear-gradient(135deg,#c7d2fe,#e0e7ff);
      overflow:hidden;display:grid;place-items:center;font-weight:1000;color:#1e293b;
      cursor:pointer;
    }
    .avatar img{width:100%;height:100%;object-fit:cover}
    .title{margin:0;font-size:20px;font-weight:1000;line-height:1.1}
    .subRow{margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    a{color:var(--blue);text-decoration:none;font-weight:1000}
    a:hover{text-decoration:underline}
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      font-weight:1000;
      font-size:11px;
      background:#f8fafc;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }

    /* Score meter */
    .scoreCard{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
      min-width:240px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .scoreTop{display:flex;justify-content:space-between;align-items:flex-end;gap:10px}
    .scoreLabel{color:var(--muted);font-weight:1000;font-size:12px}
    .scoreValue{font-weight:1000;font-size:22px;line-height:1}
    .meter{
      width:100%;
      height:14px;
      border-radius:999px;
      background:#f1f5f9;
      border:1px solid var(--line);
      overflow:hidden;
    }
    .meterFill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, #16a34a 0%, #f59e0b 55%, #ef4444 100%);
      transition: width .2s ease;
    }
    .meterTicks{display:flex;justify-content:space-between;color:var(--muted);font-weight:900;font-size:11px}

    /* Cards */
    .grid{margin-top:16px;display:grid;grid-template-columns:1fr;gap:16px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .cardHeader{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .cardTitle{margin:0;font-weight:1000;font-size:15px}
    .muted{color:var(--muted);font-weight:750;font-size:13px;line-height:1.45}

    /* Flags + deep dive */
    .flagsWrap{display:grid;grid-template-columns: 1.1fr .9fr;gap:14px}
    @media (max-width: 920px){ .flagsWrap{grid-template-columns:1fr} }
    .flagsList{display:flex;flex-wrap:wrap;gap:8px}
    .flagChip{
      border:1px solid var(--line);
      background:#f8fafc;
      border-radius:999px;
      padding:7px 10px;
      font-weight:1000;
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }
    .flagChip.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .flagChip .count{
      background:#fff;border:1px solid var(--line);
      padding:3px 7px;border-radius:999px;font-size:11px;color:var(--muted)
    }
    .flagChip.active .count{color:#0f172a}
    .deepDive{
      border:1px solid var(--line);
      border-radius:16px;
      background:#fff;
      padding:12px;
      min-height:120px;
    }
    .deepDiveTitle{font-weight:1000;margin:0 0 10px;font-size:13px}
    .wordsGrid{display:flex;flex-wrap:wrap;gap:8px}
    .wordPill{
      font-size:12px;font-weight:1000;
      padding:7px 10px;border-radius:999px;border:1px solid var(--line);
      background:#fff;
    }

    /* Flag hits bar (0..33) */
    .kpi{
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      background:#fff;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .kpiTop{display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap}
    .kpiTop .big{font-size:26px;font-weight:1000;line-height:1}
    .kpiTop .small{font-size:12px;color:var(--muted);font-weight:900;text-align:right}
    .bar{width:100%;height:12px;border-radius:999px;background:#f1f5f9;border:1px solid var(--line);overflow:hidden}
    .bar>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#ef4444,#f59e0b);transition:width .2s ease}
    .barLegend{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;font-weight:900}

    /* Summary (match layout font + spacing per item) */
    .summaryList{display:flex;flex-direction:column;gap:12px}
    .summaryItem{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:12px;
    }
    .summaryItemTitle{
      font-weight:1000;
      font-size:13px;
      margin:0 0 6px;
    }
    .summaryItemText{
      margin:0;
      color:var(--text);
      font-weight:500;
      font-size:13px;
      line-height:1.5;
      white-space:pre-wrap;
    }

    /* Evidence */
    .filters{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:12px}
    .filterGroup{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .boxes{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width: 980px){.boxes{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 620px){.boxes{grid-template-columns:1fr}}

    .box{border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden;display:flex;flex-direction:column;min-height:220px}
    .boxImg{height:130px;background:linear-gradient(135deg,#e2e8f0,#f1f5f9)}
    .boxImg img{width:100%;height:100%;object-fit:cover}
    .boxBody{padding:12px;display:flex;flex-direction:column;gap:10px;flex:1}
    .boxTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
    .date{color:var(--muted);font-weight:900;font-size:11px}
    .titleLink{font-weight:1000;color:var(--blue);text-decoration:none;line-height:1.25;font-size:13px}
    .titleLink:hover{text-decoration:underline}
    .snippet{color:var(--text);font-weight:750;font-size:13px;line-height:1.35;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;min-height:60px}
    .tagRow{display:flex;flex-wrap:wrap;gap:8px;margin-top:auto}
    .miniTag{font-size:11px;font-weight:1000;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--text)}

    .pagination{margin-top:14px;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap}
    .pageBtn{border:1px solid var(--line);background:#fff;padding:8px 10px;border-radius:10px;font-weight:1000;cursor:pointer;min-width:38px;text-align:center}
    .pageBtn.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .pageInfo{color:var(--muted);font-weight:900;font-size:12px;margin-top:10px;text-align:center}
  </style>
</head>

<body>
  <div class="container">

    <!-- TOP SELECTOR (always visible) -->
    <section class="topBar">
      <div class="picker">
        <input id="search" type="search" placeholder="Search by name or Instagram (e.g., Bad Bunny / @badbunnypr)"/>
        <select id="select">
          <option value="">Select an influencer…</option>
        </select>
        <button class="btn primary" id="openBtn">Open</button>

        <!-- Language selector -->
        <select id="langSelect" style="max-width:180px;flex:0 0 auto">
          <option value="en" selected>English (EN)</option>
          <option value="pt">Português (PT)</option>
          <option value="es">Español (ES)</option>
        </select>
      </div>
    </section>

    <!-- EMPTY STATE (shown until selection) -->
    <section class="empty" id="emptyState">
      <h2 class="emptyTitle" data-i18n="emptyTitle">Select an influencer</h2>
      <p class="emptyText" data-i18n="emptyText">
        Use the search box or the dropdown above. Once selected, the reputation view will appear here.
      </p>
    </section>

    <!-- MAIN VIEW (hidden until selection) -->
    <div id="mainView" style="display:none">
      <!-- Header -->
      <section class="header">
        <div class="left">
          <!-- Clicking avatar/name/handle goes to Instagram profile -->
          <a id="igHeaderLink" href="#" target="_blank" rel="noreferrer"
             style="display:flex;gap:14px;align-items:center;color:inherit;text-decoration:none">
            <div class="avatar" id="avatar">
              <img id="avatarImg" alt="avatar" src="" style="display:none"/>
              <span id="avatarFallback">IN</span>
            </div>
            <div>
              <h1 class="title" id="infName">—</h1>
              <div class="subRow">
                <span class="pill" id="igHandlePill">@—</span>
              </div>
            </div>
          </a>
        </div>

        <div class="scoreCard">
          <div class="scoreTop">
            <div>
              <div class="scoreLabel" data-i18n="scoreLabel">Score (0–100)</div>
              <div class="scoreValue" id="scoreValue">0</div>
            </div>
          </div>
          <div class="meter"><div class="meterFill" id="meterFill"></div></div>
          <div class="meterTicks"><span>0</span><span>50</span><span>100</span></div>
        </div>
      </section>

      <div class="grid">

        <!-- (1) FLAGS + DEEP DIVE -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle" data-i18n="flagsTitle">Flags (tags) + Deep dive (keywords)</h3>
          </div>

          <div class="flagsWrap">
            <div>
              <div class="flagsList" id="flagsList"></div>
              <div class="muted" style="margin-top:10px" data-i18n="flagsHint">
                Click a flag to see the detected keywords.
              </div>
            </div>

            <div class="deepDive">
              <p class="deepDiveTitle" id="deepDiveTitle" data-i18n="deepDiveTitle">Detected keywords</p>
              <div class="wordsGrid" id="wordsGrid"></div>
              <div class="muted" id="deepDiveHint" style="margin-top:10px;display:none" data-i18n="deepDiveEmpty">
                No keywords for this flag.
              </div>
            </div>
          </div>
        </section>

        <!-- (2) FLAG HITS (0..33) -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle" data-i18n="flagHitsTitle">Flag hits (0–33)</h3>
          </div>

          <div class="kpi">
            <div class="kpiTop">
              <div>
                <div style="font-weight:1000;font-size:13px" data-i18n="flagHitsTotal">Total flags hit</div>
                <div class="big" id="flagHitsTotal">0</div>
              </div>
              <div class="small">
                Max: <span id="flagHitsMax">33</span><br/>
                % bar: <span id="flagHitsPct">0%</span>
              </div>
            </div>

            <div class="bar"><span id="flagHitsBar"></span></div>
            <div class="barLegend">
              <span>0</span><span>33</span>
            </div>

            <div class="muted" data-i18n="flagHitsFootnote">
              Total flags hit = number of <b>unique tags</b> detected for this influencer.
            </div>
          </div>
        </section>

        <!-- (3) SUMMARY -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle" data-i18n="summaryTitle">Influencer Executive Assessment</h3>
          </div>
          <div class="summaryList" id="summaryList"></div>
        </section>

        <!-- (4) EVIDENCE -->
        <section class="card">
          <div class="cardHeader">
            <h3 class="cardTitle" data-i18n="evidenceTitle">Evidence (Web / News)</h3>
          </div>

          <div class="filters">
            <div class="filterGroup">
              <select id="flagFilter">
                <option value="all" data-i18n="filterByFlag">Filter by Flag (tag)</option>
              </select>
              <select id="sortFilter">
                <option value="recent" data-i18n="sortRecent">Sort: Most recent</option>
                <option value="quantity" data-i18n="sortQuantity">Sort: Quantity (keywords per tag)</option>
              </select>
            </div>
          </div>

          <div class="boxes" id="boxes"></div>

          <div class="pagination" id="pagination"></div>
          <div class="pageInfo" id="pageInfo"></div>

          <div class="muted" style="margin-top:12px" data-i18n="newsFootnote">
            News cards attempt to load a website preview image via a public service (best effort).
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // ============================================================================
    // I18N (UI strings + summary headings + tag names)
    // ============================================================================
    let LANG = 'en';
    const I18N = {
      en: {
        searchPlaceholder: "Search by name or Instagram (e.g., Bad Bunny / @badbunnypr)",
        open: "Open",
        emptyTitle: "Select an influencer",
        emptyText: "Use the search box or the dropdown above. Once selected, the reputation view will appear here.",
        scoreLabel: "Score (0–100)",
        flagsTitle: "Flags (tags) + Deep dive (keywords)",
        flagsHint: "Click a flag to see the detected keywords.",
        deepDiveTitle: "Detected keywords",
        deepDiveEmpty: "No keywords for this flag.",
        flagHitsTitle: "Flag hits (0–33)",
        flagHitsTotal: "Total flags hit",
        flagHitsFootnote: "Total flags hit = number of <b>unique tags</b> detected for this influencer.",
        summaryTitle: "Influencer Executive Assessment",
        evidenceTitle: "Evidence (Web / News)",
        filterByFlag: "Filter by Flag (tag)",
        sortRecent: "Sort: Most recent",
        sortQuantity: "Sort: Quantity (keywords per tag)",
        newsFootnote: "News cards attempt to load a website preview image via a public service (best effort).",
        noFlags: "No flags.",
        noEvidence: "No evidence for this filter.",
        pillNews: "WEB/NEWS",
        // summary headings mapping
        summaryHeadings: {
          "1. Profile Context": "1. Profile Context",
          "2. Positive Reputation Signals": "2. Positive Reputation Signals",
          "3. Legal, Regulatory & Reputational Exposure": "3. Legal, Regulatory & Reputational Exposure",
          "4. Net Brand Association Assessment": "4. Net Brand Association Assessment",
          "5. Recommendation": "5. Recommendation",
          "5. Legal Positioning Recommendation": "5. Legal Positioning Recommendation"
        },
        // tag names
        tags: {
          "sensitive political topics": "sensitive political topics",
          "Negative Sentiment": "Negative Sentiment",
          "Collaboration Experience": "Collaboration Experience",
          "Protest": "Protest",
          "Abuse": "Abuse",
          "brand endorsement": "brand endorsement"
        }
      },
      pt: {
        searchPlaceholder: "Busque por nome ou Instagram (ex.: Bad Bunny / @badbunnypr)",
        open: "Abrir",
        emptyTitle: "Selecione um influencer",
        emptyText: "Use a busca ou o seletor acima. Ao selecionar, a visão de reputação aparece aqui.",
        scoreLabel: "Score (0–100)",
        flagsTitle: "Flags (tags) + Detalhamento (palavras‑chave)",
        flagsHint: "Clique em uma flag para ver as palavras‑chave detectadas.",
        deepDiveTitle: "Palavras‑chave detectadas",
        deepDiveEmpty: "Sem palavras‑chave para esta flag.",
        flagHitsTitle: "Flags acionadas (0–33)",
        flagHitsTotal: "Total de flags",
        flagHitsFootnote: "Total de flags = número de <b>tags únicas</b> detectadas para este influencer.",
        summaryTitle: "Avaliação Executiva do Influencer",
        evidenceTitle: "Evidências (Web / News)",
        filterByFlag: "Filtrar por Flag (tag)",
        sortRecent: "Ordenar: Mais recente",
        sortQuantity: "Ordenar: Quantidade (palavras‑chave por tag)",
        newsFootnote: "Os cards tentam carregar uma imagem de prévia pública (best effort).",
        noFlags: "Sem flags.",
        noEvidence: "Sem evidências para este filtro.",
        pillNews: "WEB/NEWS",
        summaryHeadings: {
          "1. Profile Context": "1. Contexto do Perfil",
          "2. Positive Reputation Signals": "2. Sinais Positivos de Reputação",
          "3. Legal, Regulatory & Reputational Exposure": "3. Exposição Legal/Regulatória & Reputacional",
          "4. Net Brand Association Assessment": "4. Avaliação de Associação à Marca",
          "5. Recommendation": "5. Recomendação",
          "5. Legal Positioning Recommendation": "5. Recomendação (Posicionamento Legal)"
        },
        tags: {
          "sensitive political topics": "temas políticos sensíveis",
          "Negative Sentiment": "sentimento negativo",
          "Collaboration Experience": "experiência de colaboração",
          "Protest": "protesto",
          "Abuse": "abuso",
          "brand endorsement": "endorsement de marca"
        }
      },
      es: {
        searchPlaceholder: "Busca por nombre o Instagram (ej.: Bad Bunny / @badbunnypr)",
        open: "Abrir",
        emptyTitle: "Selecciona un influencer",
        emptyText: "Usa la búsqueda o el selector arriba. Al seleccionar, verás la vista de reputación aquí.",
        scoreLabel: "Puntaje (0–100)",
        flagsTitle: "Flags (tags) + Análisis (palabras clave)",
        flagsHint: "Haz clic en una flag para ver las palabras clave detectadas.",
        deepDiveTitle: "Palabras clave detectadas",
        deepDiveEmpty: "No hay palabras clave para esta flag.",
        flagHitsTitle: "Flags activadas (0–33)",
        flagHitsTotal: "Total de flags",
        flagHitsFootnote: "Total de flags = número de <b>tags únicas</b> detectadas para este influencer.",
        summaryTitle: "Evaluación Ejecutiva del Influencer",
        evidenceTitle: "Evidencias (Web / Noticias)",
        filterByFlag: "Filtrar por Flag (tag)",
        sortRecent: "Ordenar: Más reciente",
        sortQuantity: "Ordenar: Cantidad (palabras clave por tag)",
        newsFootnote: "Las tarjetas intentan cargar una imagen de vista previa pública (best effort).",
        noFlags: "Sin flags.",
        noEvidence: "Sin evidencias para este filtro.",
        pillNews: "WEB/NEWS",
        summaryHeadings: {
          "1. Profile Context": "1. Contexto del Perfil",
          "2. Positive Reputation Signals": "2. Señales Positivas de Reputación",
          "3. Legal, Regulatory & Reputational Exposure": "3. Exposición Legal/Regulatoria y Reputacional",
          "4. Net Brand Association Assessment": "4. Evaluación de Asociación de Marca",
          "5. Recommendation": "5. Recomendación",
          "5. Legal Positioning Recommendation": "5. Recomendación (Posicionamiento Legal)"
        },
        tags: {
          "sensitive political topics": "temas políticos sensibles",
          "Negative Sentiment": "sentimiento negativo",
          "Collaboration Experience": "experiencia de colaboración",
          "Protest": "protesta",
          "Abuse": "abuso",
          "brand endorsement": "endorsement de marca"
        }
      }
    };

    function t(key){ return (I18N[LANG] && I18N[LANG][key]) ?? (I18N.en[key] ?? key); }
    function tHeading(line){
      const m = String(line||"").match(/^(\d+\.\s.+)$/);
      if(!m) return line;
      const dict = I18N[LANG]?.summaryHeadings || I18N.en.summaryHeadings;
      return dict[m[1]] || line;
    }
    function tTag(tag){
      const dict = I18N[LANG]?.tags || I18N.en.tags;
      return dict[tag] || tag;
    }
    function applyI18NStatic(){
      document.getElementById('search').placeholder = t('searchPlaceholder');
      document.getElementById('openBtn').textContent = t('open');
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        el.innerHTML = t(key);
      });
      // Atualiza default do select (topo)
      const sel = document.getElementById('select');
      if(sel && sel.options[0]) sel.options[0].text = t('emptyTitle') + '…';
      // Atualiza filtros
      const ff = document.getElementById('flagFilter'); if(ff && ff.options[0]) ff.options[0].text = t('filterByFlag');
      const sf = document.getElementById('sortFilter'); if(sf && sf.options[0] && sf.options[1]) { sf.options[0].text = t('sortRecent'); sf.options[1].text = t('sortQuantity'); }
    }
    document.getElementById('langSelect').addEventListener('change', (e)=>{
      LANG = e.target.value || 'en';
      // Reaplica textos estáticos e re-render para atualizar conteúdos dinâmicos
      applyI18NStatic();
      const keep = selectedInfluencerId;
      renderMain();
      selectedInfluencerId = keep;
    });

    // ============================================================================
    // INFLUENCERS LIST
    // ============================================================================
    const INFLUENCERS = [
      { influencer_id: "bad_bunny", name: "Bad Bunny", instagram_handle: "badbunnypr" },
      { influencer_id: "ewan_mcgregor", name: "Ewan McGregor", instagram_handle: "officialewanmcgregor_" },
      { influencer_id: "taylor_fritz",  name: "Taylor Fritz",  instagram_handle: "taylor_fritz" },
      { influencer_id: "vincent_cassel", name: "Vincent Cassel", instagram_handle: "vincentcassel" }
    ];

    // ============================================================================
    // OUTPUTS (manual paste) — CORRIGIDO
    // ============================================================================
    const OUTPUTS = {
      bad_bunny: {
        score_0_100: 85,
        flag_counting_rows: [
          { influencer: "Bad Bunny", tag: "sensitive political topics", words: "super|bowl|halftime|probe|congress|fcc|backlash|trump|maga|immigration|spanish|lyrics" }
        ],
        evidence_links_rows: [
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.axios.com/2026/02/10/bad-bunny-super-bowl-halftime-show-fcc-investigation" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.nytimes.com/2026/02/09/us/trump-bad-bunny-super-bowl-halftime-show.html" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.theguardian.com/us-news/2026/feb/08/bad-bunny-super-bowl-trump-maga" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.bbc.com/news/articles/cd0y18g8g7ro" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://people.com/gop-congressmen-want-investigation-bad-bunny-super-bowl-halftime-show-11904547" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://time.com/7376165/ogles-bad-bunny-super-bowl-halftime-sexual-lyrics-congress-investigation/" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.nbcnews.com/pop-culture/pop-culture-news/jill-zarin-fired-real-housewives-revival-show-controversial-bad-bunny-rcna258416" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://abcnews.go.com/US/trump-calls-bad-bunnys-super-bowl-halftime-show/story?id=129980124" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.cbc.ca/news/world/trump-bad-bunny-super-bowl-halftime-show-latino-voters-9.7081577" },
          { influencer: "Bad Bunny", tag: "sensitive political topics", url: "https://www.politico.com/news/2026/02/08/bad-bunny-super-bowl-immigration-00770475" }
        ],
        summary_text: `1. Profile Context
Bad Bunny is a globally recognized Latin music artist with high relevance for campaigns targeting diverse and youth-oriented audiences. This assessment is prompted by recent high-profile controversy linked to his Super Bowl halftime performance and ongoing public discourse regarding his cultural and political advocacy.
2. Positive Reputation Signals
Bad Bunny maintains significant credibility and cultural influence, with a history of professional engagement and strong alignment to causes resonant with multicultural and progressive demographics. His visibility and advocacy may enhance brand relevance in markets prioritizing diversity and inclusion.
3. Legal, Regulatory & Reputational Exposure
Bad Bunny’s association with explicit content, overt political symbolism, commentary on sensitive immigration and cultural topics, and public critiques from right-wing political figures suggest potential for regulatory scrutiny and reputational exposure. Prior congressional inquiries and calls for FCC investigation may indicate an elevated likelihood of public or political backlash, especially among conservative stakeholders.
4. Net Brand Association Assessment
Bad Bunny’s association with explicit content, overt political symbolism, commentary on sensitive immigration and cultural topics, and public critiques from right-wing political figures suggest potential for regulatory scrutiny and reputational exposure. Prior congressional inquiries and calls for FCC investigation may indicate an elevated likelihood of public or political backlash, especially among conservative stakeholders.
5. Legal Positioning Recommendation
Suitable with safeguards / monitoring. Partnership should include enhanced compliance review, content alignment protocols, and ongoing monitoring for emerging risks. Escalation advised if campaign objectives intersect with sensitive policy or regulatory domains.`
        }
      },

      ewan_mcgregor: {
        score_0_100: 62,
        flag_counting_rows: [
          { influencer: "Ewan McGregor", tag: "Sensitive Political Topics", words: "snub|interview|piers|morgan|womens|march|row|boris|johnson|brexit|tweets|tirade" }
        ],
        evidence_links_rows: [
          { influencer: "Ewan McGregor", tag: "Sensitive Political Topics", url: "https://www.theguardian.com/film/2017/jan/24/ewan-mcgregor-snubs-good-morning-britain-interview-piers-morgan-womens-march-row" },
          { influencer: "Ewan McGregor", tag: "Sensitive Political Topics", url: "https://www.usatoday.com/story/news/nation-now/2016/06/30/ewan-mcgregor-foul-mouthed-tirade-boris-johnson-brexit/86554272/" }
        ],
        summary_text: `1. Profile Context
Ewan McGregor is a high-profile actor known for roles in globally recognized productions and ongoing media visibility. His relevance for partnership consideration is high due to significant public reach; recent media coverage has prompted an assessment in relation to sensitive topics and public conduct.
2. Positive Partnership Signals
McGregor demonstrates credible professional standing, industry recognition, and alignment with public health initiatives, including active promotion of COVID-19 relief efforts. His participation in reputable philanthropic campaigns and general media engagement may indicate positive transparency and social responsibility.
3. Legal, Regulatory & Reputational Exposure
Exposure stems from political commentary/alignments reported in press and past personal-life coverage. Monitor narratives across UK/US outlets.
4. Net Partnership Exposure Assessment
Analysis suggests potential exposure related to McGregor’s public commentary on political figures and UK political campaigns, as well as past association with publicly reported personal relationship controversies. His involvement with politically sensitive content and cross-platform entertainment competitors also presents possible brand, regulatory, and reputational considerations.
5. Legal Positioning Recommendation
Suitable with safeguards / monitoring`
        }
      },

      taylor_fritz: {
        score_0_100: 12,
        flag_counting_rows: [
          { influencer: "Taylor Fritz", tag: "Negative Sentiment",       words: "trolls|abuse|comments|backlash|social|media|australian|open|criticize|defend|clap|respond" },
          { influencer: "Taylor Fritz", tag: "Collaboration Experience", words: "collaboration|brand|lifestyle|partnership|campaign|fashion|gen|crew|tennis|dc|open" },
          { influencer: "Taylor Fritz", tag: "Protest",                  words: "climate|protest|match|delay|washington|guardian|crowd|hold|off" },
          { influencer: "Taylor Fritz", tag: "Abuse",                    words: "harassment|online|abuse|trolls|backlash|comments|posts" }
        ],
        evidence_links_rows: [
          { influencer: "Taylor Fritz", tag: "Negative Sentiment", url: "https://www.dailymail.co.uk/sport/tennis/article-14494687/Tennis-WAG-Morgan-Riddle-boyfriend-Taylor-Fritz-trolls.html" },
          { influencer: "Taylor Fritz", tag: "Negative Sentiment", url: "https://www.express.co.uk/sport/tennis/2160031/taylor-fritz-girlfriend-morgan-riddle-australian-open" },
          { influencer: "Taylor Fritz", tag: "Collaboration Experience", url: "https://www.si.com/onsi/serve/interviews/taylor-fritz-beach-inspired-tennis-collaboration-dc-open" },
          { influencer: "Taylor Fritz", tag: "Collaboration Experience", url: "https://people.com/morgan-riddle-tennis-star-boyfriend-taylor-fritz-make-tennis-cool-again-7570078" },
          { influencer: "Taylor Fritz", tag: "Protest", url: "https://www.theguardian.com/sport/2023/aug/05/taylor-fritz-andy-murray-citi-open-climate-protest-tennis" },
          { influencer: "Taylor Fritz", tag: "Abuse", url: "https://www.express.co.uk/sport/tennis/2160031/taylor-fritz-girlfriend-morgan-riddle-australian-open" }
        ],
        summary_text: `1. Profile Context
Taylor Fritz is a professional tennis player considered for brand partnership following recent public engagement, increased media visibility, and collaborative activity, prompting a risk and legal exposure assessment.
2. Positive Reputation Signals
Fritz demonstrates collaboration experience through a recent partnership with a recognized lifestyle brand, indicating commercial viability and professional conduct. His affiliations suggest established credibility and positive brand association within the sports and entertainment sector.
3. Risk & Sensitivity Factors
Exposure indicators include negative social media discourse targeting an associate (Fritz's girlfriend), public commentary on sensitive issues such as domestic violence (involving other parties), and association with events subject to protest activity. These elements may contribute to perceived reputational vulnerability and audience sentiment volatility, though direct involvement in policy violations or misconduct by Fritz himself is not evident.4. Net Brand Association Assessment
Low-to-moderate exposure; good fit for lifestyle/Gen Z positioning with standard guardrails.
4. Net Partnership Exposure Assessment
Overall exposure level may be considered moderate, characterized primarily by indirect association with contentious topics rather than substantiated personal misconduct. Risk factors are subject to heightened media attention but may be mitigated through monitoring and responsive communications protocols.
5. Recommendation
Suitable with safeguards / monitoring (comment moderation; content review pre-brief).`
        }
      },

      vincent_cassel: {
        score_0_100: 30,
        flag_counting_rows: [
          { influencer: "Vincent Cassel", tag: "brand endorsement", words: "fashion|moncler|show|brand|campaign|style|cinema|influences|modeling|event|exclusive|dialogue" }
        ],
        evidence_links_rows: [
          { influencer: "Vincent Cassel", tag: "brand endorsement", url: "https://infobae.com/entretenimiento/2025/03/20/vincent-cassel-sobre-su-influencias-en-el-cine-y-la-moda-es-cuestion-de-dejarse-llevar" }
        ],
        summary_text: `1. Profile Context
Vincent Cassel is a public figure with an established career in entertainment and modeling, recently associated with Moncler via participation in an exclusive fashion event. This assessment is triggered by direct brand collaboration and endorsement activity.
2. Positive Reputation Signals
Cassel’s engagement with Moncler demonstrates alignment between his personal brand and the company’s image, suggesting credibility and professional conduct within public-facing collaborations. No indicators of opaque or misleading representation were identified in this context.
3. Risk & Sensitivity Factors
Current evidence does not reference past controversies or misconduct relating to Cassel or his Moncler collaboration. The partnership context is limited to fashion endorsement, which may indicate minimal regulatory or reputational exposure unless further information emerges.
4. Net Brand Association Assessment
Available information supports a low exposure profile from both legal and reputational perspectives, with positive signals outweighing risk indicators. The potential for adverse impact appears limited based on the scope of existing collaboration.
5. Recommendation
Suitable for partnership. Continued monitoring is advisable to ensure ongoing alignment with legal, compliance, and brand safety standards.`
      }
    };

    // ============================================================================
    // DOM + STATE
   Id = "";
    let activeTag = null;
    let currentPage = 1;
    const pageSize = 6;

    // ============================================================================
    // Helpers
    // ============================================================================
    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    function escapeAttr(str){ return encodeURI(String(str ?? "")); }

    function instagramUrl(handle){
      return handle ? `https://www.instagram.com/${encodeURIComponent(handle)}/` : "#";
    }
    function instagramAvatarUrl(handle){
      return handle ? `https://unavatar.io/instagram/${encodeURIComponent(handle)}` : "";
    }

    function renderScore(score){
      const s = Math.max(0, Math.min(100, Number(score) || 0));
      $("scoreValue").textContent = String(s);
      $("meterFill").style.width = s + "%";
    }

    function buildTagKeywordsMap(rows){
      const map = new Map();
      (rows || []).forEach(r => {
        const tag = (r.tag || "").trim();
        const parts = String(r.words || "")
          .split("|")
          .map(w => w.trim())
          .filter(Boolean);
        if(!map.has(tag)) map.set(tag, new Set());
        const set = map.get(tag);
        parts.forEach(p => set.add(p));
      });
      return map;
    }

    function buildTagCounts(tagKeywordsMap){
      const counts = [];
      for(const [tag, set] of tagKeywordsMap.entries()){
        counts.push({ tag, count: set.size });
      }
      counts.sort((a,b) => b.count - a.count);
      return counts;
    }

    // Flag hits (0..33): number of unique tags found
    function computeFlagHits(tagCounts){
      return Math.min(33, (tagCounts || []).length);
    }

    function normalizeEvidence(rows){
      const seen = new Set();
      const out = [];
      (rows || []).forEach(r => {
        const tag = (r.tag || "").trim();
        const url = (r.url || "").trim();
        if(!tag || !url) return;

        const key = tag + "||" + url;
        if(seen.has(key)) return;
        seen.add(key);

        const previewImg = `https://image.thum.io/get/width/900/${encodeURIComponent(url)}`;

        out.push({
          evidence_id: "ev_" + String(out.length + 1).padStart(3,"0"),
          tag,
          url,
          title: url,
          snippet: "",
          publication_date: "",
          image_url: previewImg
        });
      });
      return out;
    }

    function renderDeepDive(tag, tagKeywordsMap){
      const set = tagKeywordsMap.get(tag) || new Set();
      $("deepDiveTitle").textContent = `${t('deepDiveTitle')} — ${tTag(tag)}`;
      $("wordsGrid").innerHTML = Array.from(set)
        .sort((a,b)=>a.localeCompare(b))
        .map(w => `<span class="wordPill">${escapeHtml(w)}</span>`)
        .join("");
      $("deepDiveHint").style.display = set.size ? "none" : "block";
    }

    // Summary parsing into items + tradução dos títulos
    function translateSummaryHeadings(text){
      const lines = String(text||'').split('\n');
      return lines.map(l => tHeading(l)).join('\n');
    }
    function parseSummaryToItems(text){
      const raw = translateSummaryHeadings(String(text || "").trim());
      if(!raw) return [];
      const lines = raw.split("\n");
      const items = [];
      let current = null;

      function pushCurrent(){
        if(current && (current.title || current.body)){
          current.body = (current.body || "").trim();
          items.push(current);
        }
      }

      for(const line of lines){
        const m = line.match(/^(\d+\.\s.*)$/);
        if(m){
          pushCurrent();
          current = { title: m[1].trim(), body: "" };
        }else{
          if(!current){
            current = { title: "Summary", body: "" };
          }
          current.body += (current.body ? "\n" : "") + line;
        }
      }
      pushCurrent();
      return items;
    }

    // Evidence: filter + sort + pagination
    function getFilteredEvidence(evidence){
      const tag = $("flagFilter").value;
      const sort = $("sortFilter").value;

      let list = [...evidence];
      if(tag !== "all") list = list.filter(ev => ev.tag === tag);

      if(sort === "quantity"){
        list.sort((a,b) => (b._tag_keyword_count||0) - (a._tag_keyword_count||0));
      }else{
        list.sort((a,b) => (b.publication_date||"").localeCompare(a.publication_date||""));
      }
      return list;
    }

    function buildPagination(totalPages){
      const btns = [];
      btns.push(`<div class="pageBtn" onclick="goPage(${Math.max(1, currentPage-1)})">«</div>`);

      const maxButtons = 7;
      let from = Math.max(1, currentPage - 2);
      let to = Math.min(totalPages, from + (maxButtons - 1));
      from = Math.max(1, to - (maxButtons - 1));

      for(let p=from;p<=to;p++){
        btns.push(`<div class="pageBtn ${p===currentPage?'active':''}" onclick="goPage(${p})">${p}</div>`);
      }
      btns.push(`<div class="pageBtn" onclick="goPage(${Math.min(totalPages, currentPage+1)})">»</div>`);
      return btns.join("");
    }
    window.goPage = function(p){
      currentPage = p;
      renderMain();
      const el = document.querySelector(".filters");
      if(el){
        window.scrollTo({ top: el.getBoundingClientRect().top + window.scrollY - 140, behavior:"smooth" });
      }
    };

    function renderEvidence(evidence){
      const list = getFilteredEvidence(evidence);
      const total = list.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      currentPage = Math.min(currentPage, totalPages);

      const start = (currentPage - 1) * pageSize;
      const slice = list.slice(start, start + pageSize);

      $("boxes").innerHTML = slice.map(ev => {
        const imgHtml = ev.image_url
          ? `<div class="boxImg">
               ${escapeAttr(ev.image_url)}
             </div>`
          : ``;

        return `
          <div class="box">
            ${imgHtml}
            <div class="boxBody">
              <div class="boxTop">
                <span class="pill">${t('pillNews')}</span>
                <span class="date"></span>
              </div>
              ${escapeAttr(ev.url)}
                ${escapeHtml(ev.title || ev.url)}
              </a>
              <div class="snippet">${escapeHtml(ev.snippet || "")}</div>
              <div class="tagRow">
                <span class="miniTag">tag: ${escapeHtml(tTag(ev.tag))}</span>
                <span class="miniTag">keywords: ${escapeHtml(ev._tag_keyword_count || 0)}</span>
              </div>
            </div>
          </div>
        `;
      }).join("") || `<div class="muted">${escapeHtml(t('noEvidence'))}</div>`;

      $("pagination").innerHTML = buildPagination(totalPages);
      const showingFrom = total === 0 ? 0 : start + 1;
      const showingTo = Math.min(total, start + slice.length);
      $("pageInfo").textContent = `${showingFrom} - ${showingTo} of ${total} (page ${currentPage}/${totalPages})`;
    }

    // ============================================================================
    // Main render after selection
    // ============================================================================
    function renderMain(){
      if(!selectedInfluencerId){
        $("mainView").style.display = "none";
        $("emptyState").style.display = "block";
        applyI18NStatic();
        return;
      }

      const inf = INFLUENCERS.find(x => x.influencer_id === selectedInfluencerId);
      const out = OUTPUTS[selectedInfluencerId];

      $("emptyState").style.display = "none";
      $("mainView").style.display = "block";

      // Instagram header link (avatar + name + handle)
      const ig = instagramUrl(inf.instagram_handle);
      $("igHeaderLink").href = ig;
      $("igHandlePill").textContent = inf.instagram_handle ? `@${inf.instagram_handle}` : "—";

      // Header
      $("infName").textContent = inf?.name || "—";
      $("avatarFallback").textContent = (inf?.name || "IN")
        .split(" ").slice(0,2).map(x=>x[0]).join("").toUpperCase();

      const img = $("avatarImg");
      img.src = instagramAvatarUrl(inf.instagram_handle);
      if(inf.instagram_handle){
        img.onload = () => { img.style.display="block"; $("avatarFallback").style.display="none"; };
        img.onerror = () => { img.style.display="none"; $("avatarFallback").style.display="block"; };
      }else{
        img.style.display="none"; $("avatarFallback").style.display="block";
      }

      renderScore(out?.score_0_100 ?? 0);

      // Compute tags/keywords
      const tagKeywordsMap = buildTagKeywordsMap(out?.flag_counting_rows || []);
      const tagCounts = buildTagCounts(tagKeywordsMap);

      if(!activeTag){
        activeTag = tagCounts[0]?.tag || null;
      }

      // Flags list
      $("flagsList").innerHTML = tagCounts.map(x => `
        <span class="flagChip ${x.tag===activeTag?'active':''}" data-tag="${escapeAttr(x.tag)}">
          ${escapeHtml(tTag(x.tag))}
          <span class="count">${escapeHtml(x.count)}</span>
        </span>
      `).join("") || `<span class="muted">${escapeHtml(t('noFlags'))}</span>`;

      // (Re)bind clicks
      document.querySelectorAll(".flagChip").forEach(el => {
        el.addEventListener("click", () => {
          activeTag = el.getAttribute("data-tag");
          // Não re-renderiza o app inteiro: atualiza só o deep-dive
          renderDeepDive(activeTag, tagKeywordsMap);
          // Atualiza seleção visual
          document.querySelectorAll(".flagChip").forEach(ch => ch.classList.remove("active"));
          el.classList.add("active");
        });
      });

      // Deep dive inicial
      if(activeTag) renderDeepDive(activeTag, tagKeywordsMap);

      // Flag hits (0..33)
      const hits = computeFlagHits(tagCounts);
      const pct = Math.round((hits / 33) * 100);
      $("flagHitsTotal").textContent = String(hits);
      $("flagHitsMax").textContent = "33";
      $("flagHitsPct").textContent = pct + "%";
      $("flagHitsBar").style.width = pct + "%";

      // Summary -> items (com títulos traduzidos)
      const items = parseSummaryToItems(out?.summary_text || "");
      $("summaryList").innerHTML = items.map(it => `
        <div class="summaryItem">
          <p class="summaryItemTitle">${escapeHtml(it.title)}</p>
          <p class="summaryItemText">${escapeHtml(it.body)}</p>
        </div>
      `).join("") || `<div class="muted">—</div>`;

      // Evidence
      const evidence = normalizeEvidence(out?.evidence_links_rows || []);
      evidence.forEach(ev => {
        const set = tagKeywordsMap.get(ev.tag) || new Set();
        ev._tag_keyword_count = set.size;
      });

      // Build tag filter options
      const tags = tagCounts.map(x => x.tag);
      const currentFilter = $("flagFilter").value || "all";
      $("flagFilter").innerHTML =
        `<option value="all">${t('filterByFlag')}</option>` +
        tags.map(tg => `<option value="${escapeAttr(tg)}">${escapeHtml(tTag(tg))}</option>`).join("");

      if(tags.includes(currentFilter)) $("flagFilter").value = currentFilter;
      else $("flagFilter").value = "all";

      renderEvidence(evidence);

      // Aplica i18n (estáticos)
      applyI18NStatic();
    }

    // ============================================================================
    // Selector behavior (search filters select list)
    // ============================================================================
    function populateSelect(options){
      document.getElementById("select").innerHTML =
        `<option value="">${t('emptyTitle')}…</option>` +
        options.map(i => `<option value="${escapeAttr(i.influencer_id)}">${escapeHtml(i.name)} (@${escapeHtml(i.instagram_handle||'')})</option>`).join("");
    }

    function applySearch(){
      const q = $("search").value.trim().toLowerCase();
      const filtered = INFLUENCERS.filter(i =>
        !q ||
        i.name.toLowerCase().includes(q) ||
        (i.instagram_handle||"").toLowerCase().includes(q) ||
        ("@" + (i.instagram_handle||"")).toLowerCase().includes(q)
      );
      populateSelect(filtered);
    }

    $("search").addEventListener("input", () => {
      const current = $("select").value;
      applySearch();
      $("select").value = current;
    });

    function openSelected(){
      selectedInfluencerId = $("select").value || "";
      activeTag = null;
      currentPage = 1;
      renderMain();
    }

    $("openBtn").addEventListener("click", () => {
      if(!$("select").value){
        selectedInfluencerId = "";
        renderMain();
        return;
      }
      openSelected();
    });

    $("flagFilter").addEventListener("change", () => { currentPage = 1; renderMain(); });
    $("sortFilter").addEventListener("change", () => { currentPage = 1; renderMain(); });

    // Init
    applyI18NStatic();
    populateSelect(INFLUENCERS);
    renderMain();
  </script>
</body>
</html>
